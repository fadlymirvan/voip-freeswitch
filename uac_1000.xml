<?xml version="1.0" encoding="ISO-8859-1"?>
<scenario name="UAC_1000">

  <!-- REGISTER without auth -->
  <send start_txn="register">
    <![CDATA[
REGISTER sip:[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch];rport
Max-Forwards: 70
From: "1000" <sip:1000@[remote_ip]>;tag=[call_number]
To: "1000" <sip:1000@[remote_ip]>
Call-ID: [call_id]
CSeq: 1 REGISTER
Contact: <sip:1000@[local_ip]:[local_port];transport=[transport]>
Expires: 3600
Content-Length: 0
User-Agent: SIPp
    ]]>
  </send>

  <!-- Expect 401 -->
  <recv response="401" auth="true" response_txn="register" />

  <!-- REGISTER with auth -->
  <send start_txn="register">
    <![CDATA[
REGISTER sip:[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch];rport
Max-Forwards: 70
From: "1000" <sip:1000@[remote_ip]>;tag=[call_number]
To: "1000" <sip:1000@[remote_ip]>
Call-ID: [call_id]
CSeq: 2 REGISTER
Contact: <sip:1000@[local_ip]:[local_port];transport=[transport]>
Expires: 3600
[authentication username=1000 password=1234]
Content-Length: 0
User-Agent: SIPp
    ]]>
  </send>

  <recv response="200" response_txn="register" />

  <pause milliseconds="2000"/>

  <send retrans="500" start_txn="invite">
    <![CDATA[
INVITE sip:1001@[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch];rport
Max-Forwards: 70
From: "1000" <sip:1000@[remote_ip]>;tag=[call_number]
To: <sip:1001@[remote_ip]>
Call-ID: [call_id]
CSeq: 1 INVITE
Contact: <sip:1000@[local_ip]:[local_port];transport=[transport]>
Content-Type: application/sdp
Content-Length: [len]

v=0
o=user1 53655765 2353687637 IN IP4 [local_ip]
s=-
c=IN IP4 [local_ip]
t=0 0
m=audio [media_port] RTP/AVP 0 8 9 111 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:9 G722/8000
a=rtpmap:111 opus/48000/2
a=rtpmap:101 telephone-event/8000
a=fmtp:111 minptime=10;useinbandfec=1
a=sendrecv

    ]]>
  </send>

  <recv response="407" auth="true" response_txn="invite">
    <action>
      <ereg regexp=";branch=[^;]*" search_in="hdr" header="Via" check_it="false" assign_to="1"/>
    </action>
  </recv>

  <send ack_txn="invite">
    <![CDATA[
ACK sip:1001@[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port][$1]
[last_From:]
[last_To:]
[last_Call-ID:]
CSeq: 1 ACK
Max-Forwards: 70
Content-Length: 0
    ]]>
  </send>

  <!-- INVITE with auth -->
  <send retrans="500" start_txn="invite">
    <![CDATA[
INVITE sip:1001@[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch];rport
Max-Forwards: 70
From: "1000" <sip:1000@[remote_ip]>;tag=[call_number]
To: <sip:1001@[remote_ip]>
Call-ID: [call_id]
CSeq: 2 INVITE
Contact: <sip:1000@[local_ip]:[local_port];transport=[transport]>
[authentication username=1000 password=1234]
Content-Type: application/sdp
Content-Length: [len]

v=0
o=user1 53655765 2353687637 IN IP4 [local_ip]
s=-
c=IN IP4 [local_ip]
t=0 0
m=audio [media_port] RTP/AVP 0 8 9 111 101
a=rtpmap:0 PCMU/8000
a=rtpmap:8 PCMA/8000
a=rtpmap:9 G722/8000
a=rtpmap:111 opus/48000/2
a=rtpmap:101 telephone-event/8000
a=fmtp:111 minptime=10;useinbandfec=1
a=sendrecv

    ]]>
  </send>

  <recv response="100" optional="true" response_txn="invite"/>
  <recv response="180" optional="true" response_txn="invite"/>
  <recv response="183" optional="true" response_txn="invite"/>
  <recv response="200" rtd="true" response_txn="invite" />

  <!-- ack 407 -->
  <send ack_txn="invite">
    <![CDATA[
ACK sip:1001@[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch];rport
Max-Forwards: 70
From: "1000" <sip:1000@[remote_ip]>;tag=[call_number]
To: <sip:1001@[remote_ip]>[peer_tag_param]
Call-ID: [call_id]
CSeq: 2 ACK
Contact: <sip:1000@[local_ip]:[local_port]>
Content-Length: 0
    ]]>
  </send>

  <nop>
    <action>
      <exec command="echo 'Call established, waiting...'" />
    </action>
  </nop>

  <pause milliseconds="10000"/>

  <!-- BYE -->
  <send>
    <![CDATA[
BYE sip:1001@[remote_ip]:[remote_port] SIP/2.0
Via: SIP/2.0/[transport] [local_ip]:[local_port];branch=[branch];rport
Max-Forwards: 70
From: "1000" <sip:1000@[remote_ip]>;tag=[call_number]
To: <sip:1001@[remote_ip]>[peer_tag_param]
Call-ID: [call_id]
CSeq: 3 BYE
Content-Length: 0
    ]]>
  </send>

  <recv response="200"/>
</scenario>